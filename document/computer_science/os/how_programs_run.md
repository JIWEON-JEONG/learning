# How Programs Run 

## Flow 

- 프로그램이 실행될 때, CPU 는 해당 프로그램을 Memory 에 올린다. 
- Memory 에 프로그램이 올라가지는 순간 "프로세스" 가 되고, 이는 CPU 가 실행 할 수 있는 상태가 된다. 

> 프로세스 : 실행중인 프로그램. 

- CPU 는 여러 프로세스를 짧은 주기로 번갈아가며 (Context Switching) 실행한다. 

> 번갈아가며 실행되는 프로세스 특성 상, 다음 실행 할 명령이나 상태를 프로세스는 알고 있어야한다.  
> 이를 PCB (Process Control Block) 에 저장한다.  
> Code, Data(전역 변수 & 함수), Heap (문자열, 객체 등 동적 변경 정보), Stack (실행 함수, 지역변수, 원시타입, 혹은 객체 메모리주소) 구조로 이루어져있고  
> Code, Data, Heap 을 메모리에 올려 수행하게 된다.

### Thread 

#### 배경 
하나의 작업이 진행될 때마다, 메모리에 Code, Data, Heap 을 올리는 작업이 무겁고 비효율적이다. 
이를 해결하기 위해 Thread 가 나왔다. 
같은 프로세스내의 작업을 효율적으로 처리하기 위한 개념.

#### 해결 
Code, Data, Heap 을 공유하여 이를 해결한다. 

#### 주의점 
공유 자원을 사용하는만큼 동시성 문제 및 동기화에 신경을 써야한다.

#### Thread and Performance

*스레드를 통해 어플리케이션 성능을 높이는 방법*
- 단일 스레드로 웹 어플리케이션을 운영하게 된다면, 여러 요청이 들어왔을 때, 요청하나가 처리될 때 까지 다른 요청들은 대기하게 된다.
- 하지만 멀티스레드를 통해 요청 마다 스레드를 할당하게 된다면, I/O 작업 (DB등 네트워크 통신)이 발생할때, 다른 클라이언트의 요청을 수행 할 수 있게 된다.
- CPU가 유휴 상태에 있을 때(I/O 대기 등) 다른 작업을 처리할 수 있게 한다.
- 멀티코어 CPU 환경에서는 여러 스레드가 실제로 동시에 다른 코어에서 실행될 수 있다.

*스레드를 무작정 늘린다고, 성능이 좋아질까?*

- 순차적으로 진행되어야 하는 기능일경우, 스레드를 통해 성능을 높이는데에는 한계점이 있다.
- Thread 또한 컨텍스트스위칭이 발생하는데, core 가 고정되어있는 상태에서 수많은 스레드가 컨텍스트스위칭이 일어날 경우, 오버헤드가 발생할 수 있다.


### Synchronize 

#### Mutex 
- Lock 기반의 단일 공유 자원일 경우 사용.

#### Semaphore
- 공유 변수를 통해 N개의 프로세스/스레드가 여러 공유 자원에 접근 할 수 있게 한다.